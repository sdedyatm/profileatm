<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Master Tombol</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    /* ─── Notifikasi Icon (Top-Right) ─── */
    #notif-icon-wrap {
      position: fixed;
      top: 14px;
      right: 16px;
      z-index: 9998;
      cursor: pointer;
      display: none;
    }

    #notif-icon-wrap.show {
      display: block;
    }

    #notif-icon {
      width: 44px;
      height: 44px;
      background: rgba(20, 20, 28, 0.82);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.45);
      transition: transform 0.18s, background 0.18s;
    }

    #notif-icon-wrap:active #notif-icon {
      transform: scale(0.88);
      background: rgba(40, 40, 55, 0.9);
    }

    #notif-icon svg {
      width: 22px;
      height: 22px;
    }

    /* Badge */
    #notif-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff3b30;
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      border-radius: 9px;
      display: none;
      align-items: center;
      justify-content: center;
      border: 2px solid #000;
      box-shadow: 0 2px 6px rgba(255, 59, 48, 0.5);
      animation: badgePulse 2s infinite;
    }

    #notif-badge.show {
      display: flex;
    }

    @keyframes badgePulse {

      0%,
      100% {
        box-shadow: 0 2px 6px rgba(255, 59, 48, 0.5);
      }

      50% {
        box-shadow: 0 2px 12px rgba(255, 59, 48, 0.85);
      }
    }

    @keyframes bellShake {

      0%,
      100% {
        transform: rotate(0deg);
      }

      15% {
        transform: rotate(-18deg);
      }

      30% {
        transform: rotate(18deg);
      }

      45% {
        transform: rotate(-12deg);
      }

      60% {
        transform: rotate(12deg);
      }

      75% {
        transform: rotate(-5deg);
      }
    }

    #notif-icon.shake {
      animation: bellShake 0.6s ease;
    }

    /* ─── Panel Notifikasi ─── */
    #notif-panel {
      position: fixed;
      top: 62px;
      right: 12px;
      width: 300px;
      max-width: calc(100vw - 24px);
      max-height: 360px;
      background: rgba(18, 18, 26, 0.95);
      backdrop-filter: blur(18px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
      z-index: 9997;
      overflow: hidden;
      transform: translateY(-12px) scale(0.96);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.22s cubic-bezier(.34, 1.56, .64, 1), opacity 0.18s;
    }

    #notif-panel.open {
      transform: translateY(0) scale(1);
      opacity: 1;
      pointer-events: auto;
    }

    .notif-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .notif-panel-header span {
      color: #fff;
      font-size: 15px;
      font-weight: 600;
    }

    #notif-clear-btn {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: .15s;
    }

    #notif-clear-btn:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.08);
    }

    #notif-list {
      overflow-y: auto;
      max-height: 290px;
      padding: 6px 0;
    }

    #notif-list::-webkit-scrollbar {
      width: 4px;
    }

    #notif-list::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.12);
      border-radius: 2px;
    }

    .notif-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      transition: background 0.15s;
      cursor: default;
    }

    .notif-item:hover {
      background: rgba(255, 255, 255, 0.04);
    }

    .notif-item.unread {
      background: rgba(59, 130, 246, 0.07);
    }

    .notif-item.unread:hover {
      background: rgba(59, 130, 246, 0.12);
    }

    .notif-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #3b82f6;
      flex-shrink: 0;
      margin-top: 5px;
    }

    .notif-item:not(.unread) .notif-dot {
      background: transparent;
    }

    .notif-text {
      flex: 1;
      min-width: 0;
    }

    .notif-text .notif-title {
      color: #fff;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.4;
      margin-bottom: 2px;
    }

    .notif-item:not(.unread) .notif-title {
      color: rgba(255, 255, 255, 0.6);
    }

    .notif-text .notif-body {
      color: rgba(255, 255, 255, 0.38);
      font-size: 11.5px;
      line-height: 1.4;
      margin-bottom: 2px;
    }

    .notif-text .notif-time {
      color: rgba(255, 255, 255, 0.28);
      font-size: 11px;
    }

    .notif-empty {
      color: rgba(255, 255, 255, 0.3);
      font-size: 13px;
      text-align: center;
      padding: 30px 16px;
    }

    /* ─── Popup Install (Bottom Sheet) ─── */
    #install-popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(3px);
      z-index: 10000;
      display: none;
      align-items: flex-end;
      justify-content: center;
    }

    #install-popup-overlay.show {
      display: flex;
    }

    #install-popup {
      background: linear-gradient(160deg, #1a1a2e 0%, #16162a 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px 24px 0 0;
      width: 100%;
      max-width: 420px;
      padding: 10px 24px 36px;
      transform: translateY(100%);
      transition: transform 0.38s cubic-bezier(.34, 1.56, .64, 1);
      position: relative;
    }

    #install-popup-overlay.show #install-popup {
      transform: translateY(0);
    }

    .popup-handle {
      width: 40px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      margin: 0 auto 18px;
    }

    .popup-icon-row {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }

    .popup-app-icon {
      width: 58px;
      height: 58px;
      border-radius: 14px;
      background: #0a0d12;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      flex-shrink: 0;
    }

    .popup-app-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .popup-app-name {
      color: #fff;
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .popup-app-desc {
      color: rgba(255, 255, 255, 0.4);
      font-size: 12px;
      line-height: 1.4;
    }

    .popup-steps {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 22px;
    }

    .popup-step {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .step-num {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #3b82f6;
      font-size: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .step-text {
      color: rgba(255, 255, 255, 0.7);
      font-size: 13px;
      line-height: 1.4;
    }

    .step-text strong {
      color: rgba(255, 255, 255, 0.95);
      font-weight: 600;
    }

    #install-popup-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 18px rgba(59, 130, 246, 0.4);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    #install-popup-btn:active {
      transform: scale(0.96);
      box-shadow: 0 2px 10px rgba(59, 130, 246, 0.3);
    }

    #install-popup-close {
      position: absolute;
      top: 14px;
      right: 18px;
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.3);
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
      transition: color 0.15s;
    }

    #install-popup-close:hover {
      color: rgba(255, 255, 255, 0.7);
    }

    /* ─── Install Trigger Pill (bottom center) ─── */
    #install-trigger {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(30, 30, 45, 0.88);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(59, 130, 246, 0.35);
      border-radius: 28px;
      padding: 10px 20px 10px 14px;
      display: none;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      z-index: 9999;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.5);
      transition: transform 0.25s cubic-bezier(.34, 1.56, .64, 1), opacity 0.2s;
      opacity: 0;
    }

    #install-trigger.show {
      display: flex;
      opacity: 1;
    }

    #install-trigger:active {
      transform: translateX(-50%) scale(0.94);
    }

    .trigger-icon {
      width: 34px;
      height: 34px;
      border-radius: 9px;
      background: #0a0d12;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      flex-shrink: 0;
    }

    .trigger-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .trigger-text {
      color: #fff;
      font-size: 13px;
      font-weight: 500;
    }

    .trigger-text span {
      color: #3b82f6;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <iframe src="https://script.google.com/macros/s/AKfycbzQCF1ypOFfNPzNJFzHVKwzEat0hd2nIs1dpTOuSVeWuIrBKTjD2Qi0xRfhnbg7RXZA/exec" allowfullscreen allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; web-share; xr-spatial-tracking">
  </iframe>

  <!-- Notifikasi Icon -->
  <div id="notif-icon-wrap" aria-label="Notifikasi">
    <div id="notif-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
        <path d="M13.73 21a2 2 0 0 1-3.46 0" />
      </svg>
    </div>
    <div id="notif-badge">0</div>
  </div>

  <!-- Panel Notifikasi -->
  <div id="notif-panel">
    <div class="notif-panel-header">
      <span>Notifikasi</span>
      <button id="notif-clear-btn">Hapus semua</button>
    </div>
    <div id="notif-list">
      <div class="notif-empty">Belum ada notifikasi</div>
    </div>
  </div>

  <!-- Install Trigger Pill -->
  <div id="install-trigger" aria-label="Install App">
    <div class="trigger-icon">
      <img src="https://play-lh.googleusercontent.com/aXqNEkv2gOWHmFdj-BfCKoBignxVAp72vUFIErD_sO_dhO2Vrei4qT57bs6rExFWnSU=w192-h192-rw" alt="icon">
    </div>
    <div class="trigger-text"><span>Install</span> Apps Atm</div>
  </div>

  <!-- Install Popup -->
  <div id="install-popup-overlay">
    <div id="install-popup">
      <button id="install-popup-close">&times;</button>
      <div class="popup-handle"></div>
      <div class="popup-icon-row">
        <div class="popup-app-icon">
          <img src="https://play-lh.googleusercontent.com/aXqNEkv2gOWHmFdj-BfCKoBignxVAp72vUFIErD_sO_dhO2Vrei4qT57bs6rExFWnSU=w192-h192-rw" alt="Apps Atm">
        </div>
        <div class="popup-app-info">
          <div class="popup-app-name">Apps Atm</div>
          <div class="popup-app-desc">Install Apps</div>
        </div>
      </div>
      <div class="popup-steps">
        <div class="popup-step">
          <div class="step-num">1</div>
          <div class="step-text">Ketik <strong>⋯ Menu</strong> di browser Anda</div>
        </div>
        <div class="popup-step">
          <div class="step-num">2</div>
          <div class="step-text">Pilih <strong>"Tambah ke layar utama"</strong></div>
        </div>
        <div class="popup-step">
          <div class="step-num">3</div>
          <div class="step-text">Ketik <strong>"Tambah"</strong> untuk konfirmasi</div>
        </div>
      </div>
      <button id="install-popup-btn">Tambah ke Layar Utama</button>
    </div>
  </div>

  <!-- Firebase SDK (compat v10) -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>

  <script>
    // ============================================================
    //   ██  FIREBASE CONFIG — GANTI DENGAN CREDENTIAL ANDA  ██
    // ============================================================
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.firebasestorage.app",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    // ============================================================
    // ─── Init Firebase & Real-time Listener ───
    const IS_PLACEHOLDER = firebaseConfig.apiKey === 'YOUR_API_KEY';
    if (!IS_PLACEHOLDER) {
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const startTime = Date.now(); // abaikan notifikasi lama yang sudah ada
      // onChildAdded: trigger SETIAP kali ada entry baru di /notifications
      db.ref('notifications').orderByChild('time').startAt(startTime).on('child_added', snap => {
        const data = snap.val();
        if (data && data.title) {
          addNotification(data.title, data.body || '');
        }
      });
    }
    // ──────────────────────────────────────────────
    //  NOTIFIKASI SISTEM (suara + badge + panel)
    // ──────────────────────────────────────────────
    const notifications = [];
    let unreadCount = 0;
    // ─── Suara notifikasi (Web Audio API) ───
    function playNotifSound() {
      try {
        const ctx = new(window.AudioContext || window.webkitAudioContext)();
        const osc1 = ctx.createOscillator(),
          g1 = ctx.createGain();
        osc1.type = 'sine';
        osc1.frequency.setValueAtTime(880, ctx.currentTime);
        g1.gain.setValueAtTime(0.18, ctx.currentTime);
        g1.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);
        osc1.connect(g1);
        g1.connect(ctx.destination);
        osc1.start(ctx.currentTime);
        osc1.stop(ctx.currentTime + 0.25);
        const osc2 = ctx.createOscillator(),
          g2 = ctx.createGain();
        osc2.type = 'sine';
        osc2.frequency.setValueAtTime(1100, ctx.currentTime + 0.12);
        g2.gain.setValueAtTime(0, ctx.currentTime);
        g2.gain.setValueAtTime(0.15, ctx.currentTime + 0.12);
        g2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.38);
        osc2.connect(g2);
        g2.connect(ctx.destination);
        osc2.start(ctx.currentTime + 0.12);
        osc2.stop(ctx.currentTime + 0.38);
      } catch (e) {}
    }
    // ─── Format waktu relatif ───
    function formatTime(date) {
      const diff = (Date.now() - date) / 1000;
      if (diff < 60) return 'Baru saja';
      if (diff < 3600) return Math.floor(diff / 60) + ' menit lalu';
      if (diff < 86400) return Math.floor(diff / 3600) + ' jam lalu';
      return new Date(date).toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'short'
      });
    }
    // ─── Render list panel ───
    function renderNotifList() {
      const list = document.getElementById('notif-list');
      if (notifications.length === 0) {
        list.innerHTML = '<div class="notif-empty">Belum ada notifikasi</div>';
        return;
      }
      list.innerHTML = notifications.map((n, i) =>
        `<div class="notif-item ${n.unread ? 'unread' : ''}" data-i="${i}">
      <div class="notif-dot"></div>
      <div class="notif-text">
        <div class="notif-title">${n.title}</div>
        ${n.body ? '<div class="notif-body">' + n.body + '</div>' : ''}
        <div class="notif-time">${formatTime(n.date)}</div>
      </div>
    </div>`
      ).join('');
      list.querySelectorAll('.notif-item').forEach(el => {
        el.addEventListener('click', () => {
          const idx = parseInt(el.dataset.i);
          if (notifications[idx] && notifications[idx].unread) {
            notifications[idx].unread = false;
            unreadCount = Math.max(0, unreadCount - 1);
            updateBadge();
            renderNotifList();
          }
        });
      });
    }
    // ─── Update badge ───
    function updateBadge() {
      const badge = document.getElementById('notif-badge');
      if (unreadCount > 0) {
        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
        badge.classList.add('show');
      } else {
        badge.classList.remove('show');
      }
    }
    // ─── Tambah notifikasi baru (dipanggil dari Firebase listener) ───
    function addNotification(title, body) {
      notifications.unshift({
        title,
        body,
        date: Date.now(),
        unread: true
      });
      unreadCount++;
      updateBadge();
      renderNotifList();
      // Shake bell
      const icon = document.getElementById('notif-icon');
      icon.classList.add('shake');
      setTimeout(() => icon.classList.remove('shake'), 650);
      // Suara
      playNotifSound();
      // Tampilkan icon
      document.getElementById('notif-icon-wrap').classList.add('show');
      // Browser Notification API (jika izin sudah diberikan)
      if (Notification.permission === 'granted') {
        new Notification(title, {
          body: body || '',
          icon: 'https://play-lh.googleusercontent.com/aXqNEkv2gOWHmFdj-BfCKoBignxVAp72vUFIErD_sO_dhO2Vrei4qT57bs6rExFWnSU=w192-h192-rw',
          silent: true
        });
      }
    }
    // ─── Toggle panel ───
    document.getElementById('notif-icon-wrap').addEventListener('click', (e) => {
      e.stopPropagation();
      const panel = document.getElementById('notif-panel');
      panel.classList.toggle('open');
      if (panel.classList.contains('open')) {
        notifications.forEach(n => n.unread = false);
        unreadCount = 0;
        updateBadge();
        renderNotifList();
      }
    });
    document.addEventListener('click', (e) => {
      const panel = document.getElementById('notif-panel');
      const wrap = document.getElementById('notif-icon-wrap');
      if (!wrap.contains(e.target) && !panel.contains(e.target)) panel.classList.remove('open');
    });
    document.getElementById('notif-clear-btn').addEventListener('click', () => {
      notifications.length = 0;
      unreadCount = 0;
      updateBadge();
      renderNotifList();
    });
    // ─── Minta izin Notification API ───
    if ('Notification' in window && Notification.permission === 'default') {
      // Tunda request sampai ada interaksi pertama
      document.addEventListener('click', function askOnce() {
        Notification.requestPermission();
        document.removeEventListener('click', askOnce);
      }, {
        once: true
      });
    }
    // ──────────────────────────────────────────────
    //  INSTALL PWA
    // ──────────────────────────────────────────────
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('install-trigger').classList.add('show');
    });
    document.getElementById('install-trigger').addEventListener('click', () => {
      document.getElementById('install-popup-overlay').classList.add('show');
    });

    function closeInstallPopup() {
      document.getElementById('install-popup-overlay').classList.remove('show');
    }
    document.getElementById('install-popup-close').addEventListener('click', closeInstallPopup);
    document.getElementById('install-popup-overlay').addEventListener('click', (e) => {
      if (e.target === document.getElementById('install-popup-overlay')) closeInstallPopup();
    });
    document.getElementById('install-popup-btn').addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const {
          outcome
        } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          closeInstallPopup();
          document.getElementById('install-trigger').classList.remove('show');
        }
        deferredPrompt = null;
      } else {
        closeInstallPopup(); // fallback: instruksi manual sudah terlihat
      }
    });
    // ─── Service Worker ───
    window.addEventListener('online', () => location.reload());
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('SW registered'))
        .catch(err => console.error('SW error:', err));
    }
  </script>
</body>

</html>
